{% extends './index.html' %}

{% block title %} Estudiante {% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="contenidoPrimaria mb-4">
        <p id="plat1">Contenido</p>
        <p id="plat2">CONTENIDO DE LOS DATOS DEL ESTUDIANTE</p>
        <p id="plat3">CONTENIDO DE LOS DATOS DEL ESTUDIANTE</p>
    </div>
    <div class="contenidoSecundaria">
        <div class="row">
            <h1>Student Manager</h1>
        <form id="addStudentForm" action="/add_student" method="post" enctype="multipart/form-data">
            <input type="text" name="nombre" placeholder="Nombre" required>
            <input type="text" name="apellido" placeholder="Apellido" required>
            <input type="email" name="email" placeholder="Correo" required>
            <input type="hidden" id="foto" name="foto">
            <input type="text" name="estado" placeholder="Estado" required>
            <video id="video" width="320" height="240" autoplay></video>
            <button type="button" id="snap">Capturar Foto</button>
            <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
            <input type="submit" value="Agregar Estudiante">
        </form>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Correo</th>
                    <th>Foto</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ student.id }}</td>
                    <td>{{ student.nombre }}</td>
                    <td>{{ student.apellido }}</td>
                    <td>{{ student.email }}</td>
                    <td><img src="data:image/png;base64,{{ student.foto }}" width="50"></td>
                    <td>{{ student.estado }}</td>
                    <td>
                        <form action="/delete_student/{{ student.id }}" method="post" style="display:inline;">
                            <input type="submit" value="Eliminar">
                        </form>
                        <button onclick="editStudent('{{ student.id }}', '{{ student.nombre }}', '{{ student.apellido }}', '{{ student.email }}', '{{ student.foto }}', '{{ student.estado }}')">Editar</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Actualizar Estudiante</h2>
        <form id="updateForm" action="/update_student" method="post">
            <input type="hidden" id="studentId" name="id">
            <input type="text" id="updateNombre" name="nombre" placeholder="Nombre" required>
            <input type="text" id="updateApellido" name="apellido" placeholder="Apellido" required>
            <input type="email" id="updateEmail" name="email" placeholder="Correo" required>
            <input type="hidden" id="updateFoto" name="foto">
            <input type="text" id="updateEstado" name="estado" placeholder="Estado" required>
            <input type="submit" value="Actualizar Estudiante">
        </form>

        <script>
            // Acceder a la c√°mara y capturar la foto
            var video = document.querySelector("#video");
            var canvas = document.querySelector("#canvas");
            var context = canvas.getContext("2d");
            var snap = document.querySelector("#snap");

            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function(stream) {
                    video.srcObject = stream;
                })
                .catch(function(err) {
                    console.log("Error: " + err);
                });

            snap.addEventListener("click", function() {
                context.drawImage(video, 0, 0, 320, 240);
                var dataURL = canvas.toDataURL("image/png");
                document.querySelector("#foto").value = dataURL;
            });

            function editStudent(id, nombre, apellido, email, foto, estado) {
                document.getElementById('studentId').value = id;
                document.getElementById('updateNombre').value = nombre;
                document.getElementById('updateApellido').value = apellido;
                document.getElementById('updateEmail').value = email;
                document.getElementById('updateEstado').value = estado;
                document.getElementById('updateFoto').value = foto;
            }
        </script>
            </div>
        </div>
</div>
{% endblock %}
